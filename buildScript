set -e

scons platform=windows module_mono_enabled=yes arch=x86_64 precision=double dev_build=yes use_mingw=yes separate_debug_symbols=yes -j8
bin/godot.windows.editor.dev.double.x86_64.mono.exe --generate-mono-glue modules/mono/glue --precision=double
python ./modules/mono/build_scripts/build_assemblies.py --godot-output-dir ./bin --push-nupkgs-local "../GodotNugetSourceData" --precision=double
scons module_mono_enabled=yes arch=x86_64 precision=double dev_build=yes use_mingw=yes separate_debug_symbols=yes -j8

# Copy nuget data to common place so it can use build templates 
cp -r ../GodotNugetSourceData   ${APPDATA}/NuGet/GodotNugetSource
cp -r ../GodotNugetSourceData   ${APPDATA}/NuGet/LocalNugetSource

if [[ -n "${TEMPLATES}" ]] ; then
    scons target=template_release tools=no arch=x86_64 module_mono_enabled=yes precision=double use_mingw=yes separate_debug_symbols=yes -j8
    scons target=template_debug tools=no arch=x86_64 module_mono_enabled=yes precision=double use_mingw=yes separate_debug_symbols=yes -j8
fi

# I should also have it refresh the project but that might be more difficult depending on the project